Import('env')

#env = Environment(tools=['default'], TARFLAGS ="-vc -z", PACKAGEROOT='target')

#env.Prepend(TARFLAGS="--transform 's,^build/,,' ")

env['prefix'] = '/usr/bin'
script_dict = {'@prefix@': '/bin', '@exec_prefix@': '$prefix on my $MACHINE'}
env.Substfile('script.in', SUBST_DICT=script_dict, SUBSTFILESUFFIX='.spec')
# triggered when stage.tar is rebuild
#env.Substfile(['script.in', 'target/stage.tar'], SUBST_DICT=script_dict, SUBSTFILESUFFIX='.spec')
 
env.Tar('target/base', [ Glob('etc/*.conf'), 'bin/' ], TARFLAGS="--transform 's,^build/,,' " + '$TARFLAGS')
env.Tar('target/stage', [ Glob('etc/*.conf'), 'bin/' ])

# builds/writes a spec file
env.Textfile(target='foo.spec', source=['Goethe', 42, 'Schiller'])
